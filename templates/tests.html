<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DAS</title>
  <link rel="icon" type="image/x-icon" href="/fav.ico">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.45;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* === All original themes restored === */
    body.light       { background: white;         color: black; }
    body.ocean       { background: #083344;       color: #01abb4; }
    body.red-light   { background: #ff0101;       color: #ffffff; }
    body.light-red   { background: #fff;          color: #ff0101; }
    body.dark        { background: black;         color: white; }
    body.midnight    { background: #0b1020;       color: #e5e7eb; }
    body.sakura      { background: #fff1f2;       color: #9f1239; }
    body.neon        { background: #020617;       color: #22d3ee; }
    body.ice         { background: #f0f9ff;       color: #075985; }
    body.sepia       { background: #f4ecd8;       color: #5b4636; }
    body.violet-dark { background: #1e102f;       color: #e9d5ff; }
    body.desert      { background: #fef3c7;       color: #92400e; }
    body.terminal    { background: #000000;       color: #33ff33; }
    body.hacker      { background: #020617;       color: #00ff9c; }
    body.fog         { background: #e5e7eb;       color: #374151; }

    /* Common elements – inherit from body colors */
    header, .footer-controls {
      background: inherit;
      border-color: rgba(128,128,128,0.3);
    }

    header {
      position: sticky;
      top: 0;
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      border-bottom: 1px solid;
    }

    #time {
      font-size: 13px;
      opacity: 0.85;
    }

    main {
      flex: 1;
      padding: 16px;
      max-width: 1100px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .editor-wrapper {
      flex: 1 1 auto;
      min-height: 220px;
      max-height: 220px;
      border: 1px solid;
      border-radius: 4px;
      overflow-x: hidden;
      overflow-y: auto;
      display: flex;
      background: rgba(0,0,0,0.25); /* subtle overlay so text is readable on colored bg */
    }


    #code {
      flex: 1;
      background: transparent;
      color: inherit;
      border: none;
      padding: 6px 10px;
      font-size: 14px;
      line-height: 1.45;
      resize: vertical;
      outline: none;
      box-sizing: border-box;
    }

    #myCanvas {
      border: 1px solid;
      border-radius: 4px;
      width: 100%;
      height: auto;
      max-height: 340px;
      aspect-ratio: 3 / 2;
      object-fit: contain;
    }

    #response {
      list-style: none;
      padding: 10px;
      margin: 0;
      border: 1px solid;
      border-radius: 4px;
      min-height: 100px;
      max-height: 100px;
      overflow-y: auto;
      font-size: 13px;
      background: rgba(0,0,0,0.3);
    }

    #response li {
      padding: 2px 0;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .footer-controls {
      padding: 12px 16px;
      border-top: 1px solid;
      display: flex;
      justify-content: center;
      gap: 16px;
      align-items: center;
    }

    button {
      background: rgba(255,255,255,0.12);
      color: inherit;
      border: 1px solid rgba(255,255,255,0.25);
      padding: 8px 18px;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button:hover {
      background: rgba(255,255,255,0.20);
    }

    #status {
      font-size: 13px;
      opacity: 0.8;
    }
  </style>
</head>
<body class="dark">

<header>
  <p>DAS (Dollar At Slash)</p>
  <div>
    <small id="time">--:--:--</small>
    <a href="/logout" style="margin-left: 20px;">
      <button>Logout</button>
    </a>
  </div>
</header>

<main>

  <div class="editor-wrapper">
    <textarea id="code" spellcheck="false" placeholder="DAS command..."></textarea>
  </div>

  <canvas id="myCanvas" width="600" height="400" style="background-color: #fff;"></canvas>

  <ul id="response"></ul>

</main>

<div class="footer-controls">
  <button id="run-btn">Run</button>
  <span id="status">Ready</span>
</div>

<script>

  const socket = io();

  const textarea = document.getElementById('code');
  const canvas   = document.getElementById('myCanvas');
  const ctx      = canvas.getContext('2d');
  const output   = document.getElementById('response');
  const runBtn   = document.getElementById('run-btn');
  const status   = document.getElementById('status');
  const timeEl   = document.getElementById('time');


  textarea.addEventListener('input', () => {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
  });


  function sendCode() {
    const text = textarea.value.trim();
    if (!text) return;
    socket.emit('client_message', { text });
    status.textContent = 'Sent…';
    setTimeout(() => status.textContent = 'Ready', 1000);
  }

  runBtn.addEventListener('click', sendCode);

  socket.on('connect',        () => status.textContent = 'Connected');
  socket.on('disconnect',     () => { status.textContent = 'Disconnected'; timeEl.textContent = '--:--:--'; });
  socket.on('time_update',    t => timeEl.textContent = t);
  socket.on('server_response', msg => {
    const li = document.createElement('li');
    li.textContent = msg;
    output.appendChild(li);
    output.scrollTop = output.scrollHeight;
  });
  socket.on('clear_ub',       () => output.innerHTML = '');
  socket.on('settheme',       theme => document.body.className = theme);

  socket.on('drawline',  ({ fromx, fromy, tox, toy, color }) => {
    ctx.beginPath();
    ctx.moveTo(Number(fromx), Number(fromy));
    ctx.lineTo(Number(tox),   Number(toy));
    ctx.strokeStyle = color || '#ccc';
    ctx.lineWidth = 1.5;
    ctx.stroke();
  });

  socket.on('drawrect',  ({ a1, a2, a3, a4, color }) => {
    ctx.fillStyle = color || 'rgba(180,180,255,0.25)';
    ctx.fillRect(Number(a1), Number(a2), Number(a3), Number(a4));
  });

  socket.on('drawtext',  ({ x, y, text, font, color }) => {
    ctx.font = font || '14px monospace';
    ctx.fillStyle = color || '#ddd';
    ctx.fillText(String(text), Number(x), Number(y));
  });

  socket.on('canvasclear', () => ctx.clearRect(0, 0, canvas.width, canvas.height));

</script>
</body>
</html>
